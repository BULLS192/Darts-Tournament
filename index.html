<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Darts Tournament Manager - V1</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Darts Tournament Manager (Browser Version V1)</h1>
    <p>
      Step 1: Add players → Step 2: Build teams → Step 3: Brackets + Finals →
      Step 4: Mystery Out → Step 5: Payouts
    </p>
    <button id="toggle-display-mode-btn">Toggle Display Mode</button>
  </header>

  <!-- SUMMARY BAR -->
  <section id="summary-section">
    <div class="summary-bar">
      <div class="summary-item">
        <div class="summary-label">Players</div>
        <div class="summary-value" id="summary-players-total">0</div>
        <div class="summary-sub">
          <span id="summary-players-paid">0</span> paid /
          <span id="summary-players-unpaid">0</span> unpaid
        </div>
      </div>
      <div class="summary-item">
        <div class="summary-label">Teams</div>
        <div class="summary-value" id="summary-teams-total">0</div>
        <div class="summary-sub">2 players per team</div>
      </div>
      <div class="summary-item">
        <div class="summary-label">First Round Matches</div>
        <div class="summary-value" id="summary-matches-total">0</div>
        <div class="summary-sub">Winner bracket</div>
      </div>
    </div>
  </section>

  <!-- STEP 1: PLAYERS -->
  <section id="players-section">
    <h2>Step 1 – Add Players</h2>
    <form id="player-form">
      <div class="form-row">
        <label>First name:
          <input type="text" id="firstName" required />
        </label>
        <label>Last name:
          <input type="text" id="lastName" required />
        </label>
      </div>
      <div class="form-row">
        <label>Nickname (optional):
          <input type="text" id="nickname" placeholder="BULL.S" />
        </label>
        <label>Gender:
          <select id="gender" required>
            <option value="">Select…</option>
            <option value="F">Female</option>
            <option value="M">Male</option>
            <option value="O">Other</option>
          </select>
        </label>
      </div>
      <button type="submit">Add Player</button>
    </form>

    <h3>Registered Players</h3>
    <table id="players-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Display Name</th>
          <th>Gender</th>
          <th>Paid?</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- Filled by JS -->
      </tbody>
    </table>

    <h3>Saved Player Database</h3>
    <div class="form-row">
      <button type="button" id="load-saved-players-btn">Load Saved Players</button>
      <button type="button" id="clear-saved-players-btn">Clear Saved Player Database</button>
    </div>
    <p class="note">
      Every new player you add is remembered in this browser as part of a player database.  
      “Load Saved Players” pulls them into a new tournament so you don’t have to re-type names.
      Clearing the database does <strong>not</strong> remove players from the current tournament.
    </p>
  </section>

  <!-- STEP 2: TEAMS -->
  <section id="teams-section">
    <h2>Step 2 – Build Teams</h2>

    <h3>Option A – Blind Draw (Random Teams of 2)</h3>
    <button id="generate-teams-btn">Generate Teams (2 players per team)</button>
    <p class="note">* This will overwrite any existing teams and re-generate them randomly.</p>

    <h3>Option B – Manual Team Creation</h3>
    <form id="manual-team-form">
      <div class="form-row">
        <label>Player 1:
          <select id="manualPlayer1"></select>
        </label>
        <label>Player 2:
          <select id="manualPlayer2"></select>
        </label>
      </div>
      <button type="submit">Add Team Manually</button>
      <p class="note">
        Players already assigned to a team are not shown here.  
        Use this if you want to choose partners instead of blind draw.
      </p>
    </form>

    <h3>Teams</h3>
    <table id="teams-table">
      <thead>
        <tr>
          <th>Team #</th>
          <th>Player 1</th>
          <th>Player 2</th>
        </tr>
      </thead>
      <tbody>
        <!-- Filled by JS -->
      </tbody>
    </table>
    <p class="note">* If there is an odd number of players, the last player will be listed as “waiting for partner / bye”.</p>
  </section>

  <!-- STEP 3: BRACKETS + FINALS -->
  <section id="matches-section">
    <h2>Step 3 – Brackets</h2>
    <div class="form-row">
      <button id="generate-matches-btn">Generate Winner Bracket</button>
        <button id="reseed-bracket-btn">Reseed Bracket (Randomize Again)</button>
  <p class="note">
    You can reshuffle the team order before any match begins.  
    Once matches are underway, reseeding will be disabled.
  </p>

    </div>

    <h3>Winner Bracket – Round 1 Matches (List)</h3>
    <table id="matches-table">
      <thead>
        <tr>
          <th>Match #</th>
          <th>Team A</th>
          <th>Team B</th>
        </tr>
      </thead>
      <tbody>
        <!-- Filled by JS -->
      </tbody>
    </table>
    <p class="note">
      * This list shows only Round 1 matches on the winner side.  
      Round 1 BYEs automatically advance to Round 2.  
      Click matches in the visual bracket below to pick winners.
    </p>

    <h3>Winner Bracket (Visual)</h3>
    <div id="winners-bracket" class="bracket-container bracket-container-top">
      <!-- Filled by JS -->
    </div>

    <h3>Loser Bracket (Visual)</h3>
    <div id="losers-bracket" class="bracket-container bracket-container-bottom">
      <!-- Filled by JS -->
    </div>
    <p class="note">
      Winner bracket losers drop to the loser bracket (first loss).  
      In the loser bracket, a second loss eliminates a team.
    </p>

    <h3>Finals / King Seat</h3>
    <div id="finals-section-inner">
      <p>
        King Seat (winner bracket champion):
        <span id="finals-king-seat-label">Not decided yet</span>
      </p>
      <p>
        Challenger (loser bracket champion):
        <span id="finals-challenger-label">Not decided yet</span>
      </p>

      <div class="finals-matches">
        <div class="finals-match-row">
          <span>Finals Match 1:</span>
          <button id="finals-match1-btn">Set winner</button>
          <span id="finals-match1-result"></span>
        </div>
        <div class="finals-match-row">
          <span>Finals Match 2 (if needed):</span>
          <button id="finals-match2-btn">Set winner</button>
          <span id="finals-match2-result"></span>
        </div>
      </div>

      <p class="note" id="finals-summary-note">
        Finals use king seat rules: the challenger from the loser bracket must beat the king seat team twice.
      </p>
    </div>

    <h3>Standings</h3>
    <div id="standings-panel">
      <!-- Filled by JS -->
    </div>

    <h3>Tournament State</h3>
    <div class="form-row">
      <button id="save-tournament-btn">Save Current Tournament</button>
      <button id="load-tournament-btn">Load Saved Tournament</button>
    </div>
    <p class="note">Saved locally in this browser only.</p>
  </section>

  <!-- STEP 4: MYSTERY OUT (MASTER OUT NUMBERS) -->
  <section id="mystery-out-section">
    <h2>Step 4 – Mystery Out (Master Out 1–180)</h2>

    <form id="mystery-out-form">
      <div class="form-row">
        <label>Winning player:
          <select id="mysteryPlayerSelect"></select>
        </label>
        <label>Out number (Master Out 1–180):
          <input
            type="number"
            id="mysteryOutNumber"
            min="1"
            max="180"
            placeholder="e.g. 32, 40, 72, 120"
          />
        </label>
      </div>
      <button type="submit">Record Mystery Out</button>
      <p class="note">
        Use this after a player wins a 501 game (Master Out).  
        Enter the final score they checked out on (doubles/triples/bull).
        Impossible checkout numbers (e.g. 1, 179) are rejected and show as “No Out”.
      </p>
    </form>

    <h3>Mystery Out Board (1–180)</h3>
    <div id="mystery-out-columns" class="mystery-columns">
      <table class="mystery-table">
        <thead>
          <tr>
            <th>Out #</th>
            <th>Status / First Player</th>
            <th>Others</th>
          </tr>
        </thead>
        <tbody id="mystery-out-table-1"></tbody>
      </table>

      <table class="mystery-table">
        <thead>
          <tr>
            <th>Out #</th>
            <th>Status / First Player</th>
            <th>Others</th>
          </tr>
        </thead>
        <tbody id="mystery-out-table-2"></tbody>
      </table>

      <table class="mystery-table">
        <thead>
          <tr>
            <th>Out #</th>
            <th>Status / First Player</th>
            <th>Others</th>
          </tr>
        </thead>
        <tbody id="mystery-out-table-3"></tbody>
      </table>
    </div>
    <p class="note">
      All numbers from 1 to 180 are shown.  
      If a number has no possible out, its status shows <strong>No Out</strong>.  
      If an out is possible but nobody has hit it yet, the status cell is blank.
    </p>
  </section>

  <!-- STEP 5: BIG HITS -->
  <section id="big-hits-section">
    <h2>Step 5 – Big Hits</h2>

    <form id="feats-form">
      <div class="form-row">
        <label>Player:
          <select id="featPlayerSelect"></select>
        </label>
        <label>Shot type:
          <select id="featTypeSelect">
            <option value="">Select shot…</option>
            <option value="High-Ton">High-Ton</option>
            <option value="White Horse">White Horse</option>
            <option value="9-Mark">9-Mark</option>
            <option value="Hat-Trick">Hat-Trick</option>
          </select>
        </label>
      </div>
      <button type="submit">Record Big Hit</button>
      <p class="note">
        Use this to track highlight shots during the tournament.
      </p>
    </form>

    <h3>Recorded Big Hits</h3>
    <table id="feats-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Player</th>
          <th>Shot</th>
          <th>Time</th>
        </tr>
      </thead>
      <tbody>
        <!-- Filled by JS -->
      </tbody>
    </table>
  </section>

  <!-- STEP 6: PAYOUTS -->


  <!-- STEP 5: PAYOUTS -->
  <section id="payouts-section">
    <h2>Step 5 – Payouts</h2>

    <form id="payout-form">
      <div class="form-row">
        <label>Entry fee per player:
          <input type="number" id="entryFee" min="0" step="0.01" placeholder="e.g. 10" />
        </label>
        <label>Total pot (override, optional):
          <input type="number" id="manualPot" min="0" step="0.01" placeholder="leave blank to auto-calc" />
        </label>
      </div>

      <div class="form-row">
        <label>Mystery Out %:
          <input type="number" id="payoutMysteryPercent" min="0" max="100" value="10" />
        </label>
        <label>1st place %:
          <input type="number" id="payoutFirstPercent" min="0" max="100" value="50" />
        </label>
        <label>2nd place %:
          <input type="number" id="payoutSecondPercent" min="0" max="100" value="30" />
        </label>
        <label>3rd place %:
          <input type="number" id="payoutThirdPercent" min="0" max="100" value="10" />
        </label>
      </div>

      <div class="form-row">
        <label>Honey Pot per player (if active):
          <input type="number" id="honeyPotPerPlayer" min="0" step="0.01" value="10" />
        </label>
        <div>
          <div class="note">
            Honey Pot triggers automatically if at least 4 female players are registered.<br />
            Last female team gets Honey Pot (2 × amount per player).
          </div>
        </div>
      </div>

      <button type="button" id="calculate-payouts-btn">Calculate Payouts</button>
      <p class="note">
        If "Total pot" is filled, it will be used directly. Otherwise, total pot = entry fee × number of paid players.
      </p>
    </form>

    <h3>Payout Summary</h3>
    <table id="payouts-table">
      <thead>
        <tr>
          <th>Item</th>
          <th>Percent</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody>
        <!-- Filled by JS -->
      </tbody>
    </table>

    <p class="note" id="payouts-info"></p>
  </section>

  <footer>
    <p>
      V1: players (+ payment, saved database), teams, winner & loser brackets (2-loss elimination),
      king seat finals, Mystery Out (1–180 full board with possible/No Out), payout calculator,
      standings, save/load, and display mode for pub view.
    </p>
  </footer>

  <script src="app.js"></script>
</body>
</html>
