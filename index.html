<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Darts Tournament Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div>
      <h1>DartsTournament</h1>
      <p>
        Step 1: Players → Step 2: Teams → Step 3: Brackets & Boards →
        Step 4: Mystery Out → Step 5: Big Hits → Step 6: Payouts
      </p>
    </div>
    <button id="toggle-display-mode-btn">Toggle Display Mode</button>
  </header>

  <!-- SUMMARY BAR -->
  <section id="summary-section">
    <div class="summary-bar">
      <div class="summary-item">
        <div class="summary-label">Players</div>
        <div class="summary-value" id="summary-players-total">0</div>
        <div class="summary-sub">
          <span id="summary-players-paid">0</span> paid /
          <span id="summary-players-unpaid">0</span> unpaid
        </div>
      </div>
      <div class="summary-item">
        <div class="summary-label">Teams</div>
        <div class="summary-value" id="summary-teams-total">0</div>
        <div class="summary-sub">2 players per team</div>
      </div>
      <div class="summary-item">
        <div class="summary-label">R1 Matches</div>
        <div class="summary-value" id="summary-matches-total">0</div>
        <div class="summary-sub">Winner bracket</div>
      </div>
    </div>
  </section>

  <!-- STEP 1: PLAYERS -->
  <section id="players-section">
    <h2>Step 1 – Add Players</h2>
    <form id="player-form">
      <div class="form-row">
        <label>First name:
          <input type="text" id="firstName" required />
        </label>
        <label>Last name:
          <input type="text" id="lastName" required />
        </label>
      </div>
      <div class="form-row">
        <label>Nickname (optional):
          <input type="text" id="nickname" placeholder="BULL.S" />
        </label>
        <label>Gender:
          <select id="gender" required>
            <option value="">Select…</option>
            <option value="F">Female</option>
            <option value="M">Male</option>
            <option value="O">Other</option>
          </select>
        </label>
      </div>
      <button type="submit">Add Player</button>
    </form>

    <h3>Registered Players</h3>
    <table id="players-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Display Name</th>
          <th>Gender</th>
          <th>Paid?</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h3>Saved Player Database</h3>
    <div class="form-row">
      <button type="button" id="load-saved-players-btn">Load Saved Players</button>
      <button type="button" id="clear-saved-players-btn">Clear Saved Player Database</button>
    </div>
    <p class="note">
      Every new player you add is remembered locally as a player database. Use
      “Load Saved Players” to pull them into a new tournament.
    </p>
  </section>

  <!-- STEP 2: TEAMS -->
  <section id="teams-section">
    <h2>Step 2 – Build Teams</h2>

    <h3>Option A – Blind Draw (Random Teams of 2)</h3>
    <button id="generate-teams-btn">Generate Teams (2 players per team)</button>
    <p class="note">This overwrites existing teams and re-randomizes them.</p>

    <h3>Option B – Manual Team Creation</h3>
    <form id="manual-team-form">
      <div class="form-row">
        <label>Player 1:
          <select id="manualPlayer1"></select>
        </label>
        <label>Player 2:
          <select id="manualPlayer2"></select>
        </label>
      </div>
      <button type="submit">Add Team Manually</button>
      <p class="note">
        Players already assigned to a team are hidden. Use this to choose partners instead of blind draw.
      </p>
    </form>

    <h3>Teams</h3>
    <table id="teams-table">
      <thead>
        <tr>
          <th>Team #</th>
          <th>Player 1</th>
          <th>Player 2</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- STEP 3: BRACKETS, BOARDS, FINALS -->
  <section id="matches-section">
    <h2>Step 3 – Brackets & Boards</h2>
    <div class="form-row">
      <button id="generate-matches-btn">Generate Winner Bracket</button>
      <button id="reseed-bracket-btn">Reseed Bracket (Randomize)</button>
    </div>
    <p class="note">
      Click a match box in the bracket to select the winner. Assign boards per match via dropdown (Boards 1–20).
    </p>

    <h3>Winner Bracket – Round 1 Matches</h3>
    <table id="matches-table">
      <thead>
        <tr>
          <th>Match #</th>
          <th>Team A</th>
          <th>Team B</th>
          <th>Board</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h3>Winner Bracket (Visual)</h3>
    <div id="winners-bracket" class="bracket-container bracket-container-top"></div>

    <h3>Loser Bracket (Visual)</h3>
    <div id="losers-bracket" class="bracket-container bracket-container-bottom"></div>

    <h3>Finals / King Seat</h3>
    <div id="finals-section-inner">
      <p>
        King Seat (winner bracket champion):
        <span id="finals-king-seat-label">Not decided yet</span>
      </p>
      <p>
        Challenger (loser bracket champion):
        <span id="finals-challenger-label">Not decided yet</span>
      </p>

      <div class="finals-matches">
        <div class="finals-match-row">
          <span>Finals Match 1:</span>
          <button id="finals-match1-btn">Set winner</button>
          <span id="finals-match1-result"></span>
        </div>
        <div class="finals-match-row">
          <span>Finals Match 2 (if needed):</span>
          <button id="finals-match2-btn">Set winner</button>
          <span id="finals-match2-result"></span>
        </div>
      </div>

      <p class="note" id="finals-summary-note">
        Finals use king seat rules: the challenger from the loser bracket must beat the king seat team twice.
      </p>
    </div>

    <h3>Standings</h3>
    <div id="standings-panel"></div>

    <h3>Tournament State</h3>
    <div class="form-row">
      <button id="save-tournament-btn">Save Current Tournament</button>
      <button id="load-tournament-btn">Load Saved Tournament</button>
    </div>
    <p class="note">Saved locally in this browser only.</p>
  </section>

  <!-- COURT ASSIGNMENTS -->
  <section id="court-assignment-section">
    <h2>Court Assignments</h2>
    <p class="note">
      Shows all active matches that have a board assigned. Use this view on a
      separate screen near the boards.
    </p>
    <table id="court-table">
      <thead>
        <tr>
          <th>Board</th>
          <th>Bracket</th>
          <th>Round</th>
          <th>Match #</th>
          <th>Teams</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- STEP 4: MYSTERY OUT -->
  <section id="mystery-out-section">
    <h2>Step 4 – Mystery Out (Master Out 1–180)</h2>

    <form id="mystery-out-form">
      <div class="form-row">
        <label>Winning player:
          <select id="mysteryPlayerSelect"></select>
        </label>
        <label>Out number (1–180):
          <input type="number" id="mysteryOutNumber" min="1" max="180" />
        </label>
      </div>
      <button type="submit">Record Mystery Out</button>
      <p class="note">
        Click a number in the board to choose a player right in the grid, or use this form. Only valid Master Out numbers (double/triple/bull finish) are accepted.
      </p>
    </form>

    <h3>Mystery Out Board (1–180)</h3>
    <div id="mystery-out-columns">
      <div class="mystery-columns">
        <table class="mystery-table">
          <thead>
            <tr>
              <th>#</th>
              <th>First Hit</th>
              <th>Others</th>
            </tr>
          </thead>
          <tbody id="mystery-out-table-1"></tbody>
        </table>

        <table class="mystery-table">
          <thead>
            <tr>
              <th>#</th>
              <th>First Hit</th>
              <th>Others</th>
            </tr>
          </thead>
          <tbody id="mystery-out-table-2"></tbody>
        </table>

        <table class="mystery-table">
          <thead>
            <tr>
              <th>#</th>
              <th>First Hit</th>
              <th>Others</th>
            </tr>
          </thead>
          <tbody id="mystery-out-table-3"></tbody>
        </table>

        <table class="mystery-table">
          <thead>
            <tr>
              <th>#</th>
              <th>First Hit</th>
              <th>Others</th>
            </tr>
          </thead>
          <tbody id="mystery-out-table-4"></tbody>
        </table>

        <table class="mystery-table">
          <thead>
            <tr>
              <th>#</th>
              <th>First Hit</th>
              <th>Others</th>
            </tr>
          </thead>
          <tbody id="mystery-out-table-5"></tbody>
        </table>

        <table class="mystery-table">
          <thead>
            <tr>
              <th>#</th>
              <th>First Hit</th>
              <th>Others</th>
            </tr>
          </thead>
          <tbody id="mystery-out-table-6"></tbody>
        </table>
      </div>
    </div>
    <p class="note">
      Numbers with no possible Master Out show “No Out”. Possible but unhit numbers are blank until someone hits them.
    </p>
  </section>

  <!-- STEP 5: BIG HITS -->
  <section id="special-shots-section">
    <h2>Step 5 – Big Hits</h2>

    <form id="feats-form">
      <div class="form-row">
        <label>Player:
          <select id="featPlayerSelect"></select>
        </label>
        <label>Big Hit:
          <select id="featTypeSelect">
            <option value="">Select…</option>
            <option value="High-Ton">High-Ton</option>
            <option value="White Horse">White Horse</option>
            <option value="9-Mark">9-Mark</option>
            <option value="Hat-Trick">Hat-Trick</option>
          </select>
        </label>
      </div>
      <button type="submit">Record Big Hit</button>
      <p class="note">
        Use this to track big highlight shots during the tournament.
      </p>
    </form>

    <h3>Recorded Big Hits</h3>
    <table id="feats-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Player</th>
          <th>Big Hit</th>
          <th>Time</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- STEP 6: PAYOUTS -->
  <section id="payouts-section">
    <h2>Step 6 – Payouts</h2>

    <form id="payout-form">
      <div class="form-row">
        <label>Entry fee per player:
          <input type="number" id="entryFee" min="0" step="0.01" placeholder="e.g. 10" />
        </label>
        <label>Total pot (override, optional):
          <input type="number" id="manualPot" min="0" step="0.01" placeholder="leave blank to auto-calc" />
        </label>
      </div>

      <div class="form-row">
        <label>Mystery Out %:
          <input type="number" id="payoutMysteryPercent" min="0" max="100" value="10" />
        </label>
        <label>Mystery Out (fixed):
          <input type="number" id="payoutMysteryFixed" min="0" step="0.01" placeholder="optional" />
        </label>
      </div>

      <div class="form-row">
        <label>1st place %:
          <input type="number" id="payoutFirstPercent" min="0" max="100" value="50" />
        </label>
        <label>1st place (fixed):
          <input type="number" id="payoutFirstFixed" min="0" step="0.01" placeholder="optional" />
        </label>
      </div>

      <div class="form-row">
        <label>2nd place %:
          <input type="number" id="payoutSecondPercent" min="0" max="100" value="30" />
        </label>
        <label>2nd place (fixed):
          <input type="number" id="payoutSecondFixed" min="0" step="0.01" placeholder="optional" />
        </label>
      </div>

      <div class="form-row">
        <label>3rd place %:
          <input type="number" id="payoutThirdPercent" min="0" max="100" value="10" />
        </label>
        <label>3rd place (fixed):
          <input type="number" id="payoutThirdFixed" min="0" step="0.01" placeholder="optional" />
        </label>
      </div>

      <div class="form-row">
        <label>4th place %:
          <input type="number" id="payoutFourthPercent" min="0" max="100" value="0" />
        </label>
        <label>4th place (fixed):
          <input type="number" id="payoutFourthFixed" min="0" step="0.01" placeholder="optional" />
        </label>
      </div>

      <div class="form-row">
        <label>5th place %:
          <input type="number" id="payoutFifthPercent" min="0" max="100" value="0" />
        </label>
        <label>5th place (fixed):
          <input type="number" id="payoutFifthFixed" min="0" step="0.01" placeholder="optional" />
        </label>
      </div>

      <div class="form-row">
        <label>6th place %:
          <input type="number" id="payoutSixthPercent" min="0" max="100" value="0" />
        </label>
        <label>6th place (fixed):
          <input type="number" id="payoutSixthFixed" min="0" step="0.01" placeholder="optional" />
        </label>
      </div>

      <div class="form-row">
        <label>Team Out %:
          <input type="number" id="payoutTeamOutPercent" min="0" max="100" value="0" />
        </label>
        <label>Team Out (fixed):
          <input type="number" id="payoutTeamOutFixed" min="0" step="0.01" placeholder="optional" />
        </label>
      </div>

      <div class="form-row">
        <label>Honey Pot per player (if active):
          <input type="number" id="honeyPotPerPlayer" min="0" step="0.01" value="10" />
        </label>
        <label>Min female players for Honey Pot:
          <input type="number" id="honeyPotThreshold" min="1" value="4" />
        </label>
      </div>

      <button type="button" id="calculate-payouts-btn">Calculate Payouts</button>
      <p class="note">
        If "Total pot" is filled, it is used directly. Otherwise, total pot = entry fee × number of paid players.
        Fixed amounts override percentages where provided.
      </p>
    </form>

    <h3>Payout Summary</h3>
    <table id="payouts-table">
      <thead>
        <tr>
          <th>Item</th>
          <th>Percent</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <p class="note" id="payouts-info"></p>
  </section>

  <footer>
    <p>
      DartsTournament – Players, Teams, Double-Elim Brackets (with boards),
      King Seat Finals, Mystery Out, Big Hits, Payouts, Save/Load, Court Assignments,
      and offline/online browser support.
    </p>
  </footer>

  <script src="app.js"></script>
</body>
</html>
